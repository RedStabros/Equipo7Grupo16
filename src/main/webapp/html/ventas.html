<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500;700&display=swap" rel="stylesheet">
<title>Tecno Gamer</title>
<link rel="icon" href="../img/logoico.ico">
<link rel="stylesheet" href="../css/secciones.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="/js/ventas.js"></script>
<script>
	window.onload = function() {
		var req = new XMLHttpRequest();
		req.open('GET', 'http://localhost:8080/contadorventa', false);
		req.send(null);
		var cont = null;
		if (req.status == 200)
			cont = JSON.parse(req.responseText);
		console.log(cont.toString());
		document.getElementById("consecutivo").value = cont+1;
	};
</script>
</head>
<body>
    <header class="header" id="inicio">
        <div class="contenedor baner">
            <img src="../img/hamburguesa.svg" alt="" class="hamburger">
            <nav class="menu-navegacion">
                <a href="../principal.jsp" class="nav-menu-link" target="_self">Inicio</a>
                <a href="usuarios.html" target="_self" class="nav-menu-link">Modulo de Usuarios</a>
                <a href="clientes.html" target="_self" class="nav-menu-link">Modulo de Clientes</a>
                <a href="proveedores.html" target="_self" class="nav-menu-link">Modulo de Proveedores</a>
                <a href="productos.html" target="_self" class="nav-menu-link">Modulo de Productos</a>                
                <a href="reportes.html" target="_self" class="nav-menu-link">Consultas y Reportes</a>
            </nav>
            <div class="contenedro head">                
	            <h2 class="titulo">Bienvenido al Sistema</h2>
                <p class="slogan">TecnoGamer para todos</p>
            </div>
            <div class="logo">
                <img src="../img/LOGO_PNG.png" alt="">
            </div>
        </div>
    </header>
    <main class="contenido">
         <section class="secciones">
             <h1 class="subtitulo">
                <br> Modulo Ventas
             </h1>
             <!--<style>
                @media print{
                    .seccion1, .btn, .columna{
                        display:none;
                    }
                }
                </style>-->
             <div class="d-flex">
                 <div class="col-sm-10 d-flex">
                     <div class="card">
                         <form action="Controlador?menu=Ventas" method="post" id="formulario">
                         <div class="card-body">
                            <div class="form-group">
                                <label for="">Datos del Usuario</label>
                            </div>
                            <div class="form-group d-flex">
                               <div class="col-sm-6 d-flex">
                                   <input type="text" name="Codigousuario" id="idU" class="form-control" placeholder="Codigo">
                                   <input type="button" id="buscarU" value="Buscar" name="accion" class="btn-info btn-sm btn2">
                               </div>
                               <div class="col-sm-6">
                                   <input type="text" name="nombresusuario" id="nombreU" class="form-control" placeholder="Datos Usuario" disabled="disabled">
                               </div>
                           </div>
                           <br>                        
                           
                            <div class="form-group">
                             <div class="form-group">
                                 <label for="">Datos del cliente</label>
                             </div>
                             <div class="form-group d-flex">
                                <div class="col-sm-6 d-flex">
                                    <input type="text" name="Codigocliente" id="idC" class="form-control" placeholder="Codigo">
                                    <input type="button" id="buscarC" value="Buscar" name="accion" class="btn-info btn-sm btn2">
                                </div>
                                <div class="col-sm-6">
                                    <input type="text" name="nombrescliente" id="nombre" class="form-control" placeholder="Datos Cliente" disabled="disabled">
                                </div>
                            </div>
                            <br>
                            <div class="line2"></div>
                            
                             <div class="form-group">
                                 <label for="">Datos Producto1</label>
                             </div>
                             <br>
                             <div class="form-group d-flex">
                                <div class="col-sm-6 d-flex">
                                    <input type="text" name="txtCodigoProducto" id="id" class="form-control" placeholder="Codigo">
                                    <input type="button" id="buscarP" value="Buscar" name="accion" class="btn-dark btn-sm btn2">
                                </div>
                                <div class="col-sm-6">
                                    <input type="text" name="txtDescripcion" id="nombre_p" class="form-control" placeholder="Datos Producto" disabled="disabled">
                                </div>
                             </div>
                             <br>                             
                             <div class="form-group d-flex">
                                <div class="col-sm-5 d-flex">
                                    <input type="text" name="txtPrecio" id="p_venta" class="form-control col-sm-4" placeholder="Precio" disabled="disabled">
                                </div><p>&nbsp</p>
                                <div class="col-sm-2">
                                    <input type="number" name="cantidad" value="1" id="cant1" class="form-control col-sm-4" placeholder="Cantidad" oninput="subtotal1()">
                                </div><p>&nbsp</p>
                                <div class="col-sm-4">
                                    <input type="text" name="txtsubtotal_p1" id="valtotal1" class="form-control col-sm-4" placeholder="Subtotal" disabled="disabled" value="0">
                                </div>
                             </div>
                             <div class="form-group">
                                 <!--<input type="button" value="Agregar Producto" name="accion" class="btn btn-info">oninput="subtotal1()"-->
                             </div>
                             <div class="line2"></div>
                                                       
                            
                             <div class="form-group">
                                 <label for="">Datos Producto2</label>
                             </div>
                             <br>
                             <div class="form-group d-flex">
                                <div class="col-sm-6 d-flex">
                                    <input type="text" name="txtCodigoProducto2" id="id2" class="form-control" placeholder="Codigo">
                                    <input type="button" id="buscarP2" value="Buscar" name="accion" class="btn-dark btn-sm btn2">
                                </div>
                                <div class="col-sm-6">
                                    <input type="text" name="txtDescripcion2" id="nombre_p2" class="form-control" placeholder="Datos Producto" disabled="disabled">
                                </div>
                             </div>
                             <br>                             
                             <div class="form-group d-flex">
                                <div class="col-sm-5 d-flex">
                                    <input type="text" name="txtPrecio2" id="p_venta2" class="form-control col-sm-4" placeholder="Precio" disabled="disabled">
                                </div><p>&nbsp</p>
                                <div class="col-sm-2">
                                    <input type="number" name="cantidad2" value="1" id="cant2" class="form-control col-sm-4" placeholder="Cantidad" oninput="subtotal2()">
                                </div><p>&nbsp</p>
                                <div class="col-sm-4">
                                    <input type="text" name="txtsubtotal_p2" id="valtotal2" class="form-control col-sm-4" placeholder="Subtotal" disabled="disabled" value="0">
                                </div>
                             </div>
                             <div class="form-group">
                                 <!--<input type="button" value="Agregar Producto" name="accion" class="btn btn-info">-->
                             </div>
                             <div class="line2"></div>
                            
                            
                             <div class="form-group">
                                 <label for="">Datos Producto3</label>
                             </div>
                             <br>
                             <div class="form-group d-flex">
                                <div class="col-sm-6 d-flex">
                                    <input type="text" name="txtCodigoProducto3" id="id3" class="form-control" placeholder="Codigo">
                                    <input type="button" id="buscarP3" value="Buscar" name="accion" class="btn-dark btn-sm btn2">
                                </div>
                                <div class="col-sm-6">
                                    <input type="text" name="txtDescripcion3" id="nombre_p3" class="form-control" placeholder="Datos Producto" disabled="disabled">
                                </div>
                             </div>
                             <br>                             
                             <div class="form-group d-flex">
                                <div class="col-sm-5 d-flex">
                                    <input type="text" name="txtPrecio3" id="p_venta3" class="form-control col-sm-4" placeholder="Precio" disabled="disabled">
                                </div><p>&nbsp</p>
                                <div class="col-sm-2">
                                    <input type="number" name="cantidad3" value="1" id="cant3" class="form-control col-sm-4" placeholder="Cantidad" oninput="subtotal3()">
                                </div><p>&nbsp</p>
                                <div class="col-sm-4">
                                    <input type="text" name="txtsubtotal_p3" id="valtotal3" class="form-control col-sm-4" placeholder="Subtotal" disabled="disabled" value="0">
                                </div>
                             </div>
                             <br>
                             <div class="form-group d-flex">
                                 <!--<input type="button" value="Agregar Producto" name="accion" class="btn btn-info">-->
                                 <input type="button" name="accion" value="Limpiar" onclick="limpiarFormulario();" class="btn btn-outline-dark">
                             </div>
                             <br>
                            
                            </div>
                            
                        </form>    
                     </div>
                 </div>
                 <div class="col-sm-4">
                     <div class="card">
                         <div class="card-body">
                            <div class="d-flex col-sm-8">
                                <label for="">Nro. Factura:&nbsp&nbsp</label>
                                <input type="text" name="txtNFactura" class="form-control" id="consecutivo" readonly="readonly">
                            </div>
                            <br>
                            <!--<table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Nro</th>
                                        <th>Codigo</th>
                                        <th>Descripcion</th>
                                        <th>Precio</th>
                                        <th>Cantidad</th>
                                        <th>IVA</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                            </table>-->
                         </div>
                     </div>
                    <div class="card-footer modulo-precio">
                        
                        <div class="col-sm-8 valor modulo-precio">
                            <input type="text" name="total" id="total_venta" class="form-control" placeholder="Subtotal=    $00.000.0" disabled="disabled">
                        </div>
                        <br>
                        <div class="col-sm-8 valor modulo-precio">
                            <input type="text" name="total" id="total_iva" class="form-control" placeholder="Iva=     $00.000.0" disabled="disabled">
                        </div>
                        <br>
                        <div class="col-sm-8 valor modulo-precio">
                            <input type="text" name="total" id="total_venta_iva" class="form-control" placeholder="TOTAL=     $00.000.0" disabled="disabled">
                        </div>
                        <br>
                        <div>
                            <input type="submit" name="accion" value="Generar Venta" class="btn btn-success" onclick="registrar()">                            
                        </div>
                        <br>
                        <div>
                            <label for="">Para generar una nueva venta,<br>recargue la pagina</label>
                            <input type="button" class="btn btn-outline-danger" onclick="window.location.reload()" value="Recargar Pagina">							
                        </div>
                        <br>
                    </div>
                 </div>
             </div>
<!--Info JSON
        <div id="mensaje" class="visiondb row g-3 col-auto table table-dark table-hover alert alert-light">

        </div>-->
        </div>
        </section>
    </main>
    <footer>
        <div class="line"></div>
        <section class="legal">
            <div class="contenedor-legal">
                <nav class="menu-legal">
                    <a href="#" class="nav-legal" target="_self">Terminos y condiciones</a>
                    <a href="#" target="_self" class="nav-legal">Politicas de privacidad</a>
                    <a href="#" target="_self" class="nav-legal">Politicas de cookies</a>
                    <br>
                    <p>Copyright - 2021 TecnoGamer.com</p>
                </nav>
            </div>
        </section>
    </footer>
    <script
	src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"
	crossorigin="anonymous"></script>
   
    <script src="../js/menu.js"></script>
    <script>
        function limpiarFormulario() {
          document.getElementById("formulario").reset();
          calcularFinales();
        }

        function subtotal1() {
			var cantidad = document.getElementById("cant1").value;
            var precio1 = document.getElementById("p_venta").value;
			var valortotal = 0.0;
			if (precio1 == "" || precio1 == null) {
				document.getElementById("valtotal1").value = 0;
			} else {
				valortotal = parseFloat(cantidad) * precio1;
				console.log("Valor 1: " + valortotal);
				document.getElementById("valtotal1").value = valortotal;
			}
			calcularFinales();

		}

        function subtotal2() {
			var cantidad = document.getElementById("cant2").value;
            var precio1 = document.getElementById("p_venta2").value;
			var valortotal = 0.0;
			if (precio1 == "" || precio1 == null) {
				document.getElementById("valtotal2").value = 0;
			} else {
				valortotal = parseFloat(cantidad) * precio1;
				console.log("Valor 2: " + valortotal);
				document.getElementById("valtotal2").value = valortotal;
			}
			calcularFinales();

		}

        function subtotal3() {
			var cantidad = document.getElementById("cant3").value;
            var precio1 = document.getElementById("p_venta3").value;
			var valortotal = 0.0;
			if (precio1 == "" || precio1 == null) {
				document.getElementById("valtotal3").value = 0;
			} else {
				valortotal = parseFloat(cantidad) * precio1;
				console.log("Valor 3: " + valortotal);
				document.getElementById("valtotal3").value = valortotal;
			}
			calcularFinales();

		}

        function calcularFinales() {
        var val1 = document.getElementById("valtotal1").value;
        var val2 = document.getElementById("valtotal2").value;
        var val3 = document.getElementById("valtotal3").value;
        totalventa = parseFloat(val1) + parseFloat(val2) + parseFloat(val3);
        document.getElementById("total_venta").value = totalventa;

        var iva = totalventa * 0.19;
        document.getElementById("total_iva").value = iva;

        document.getElementById("total_venta_iva").value = iva + totalventa;
        }

        function registrar() {
			try {

				formData = new FormData();
				formData.append("codigo_venta2", document.getElementById("consecutivo").value);
				formData.append("cedula_c", document.getElementById("idC").value);
				formData.append("cedula_usuario", document.getElementById("idU").value);
				formData.append("ivaventa", document.getElementById("total_iva").value);
				formData.append("total_venta", document.getElementById("total_venta").value);
				formData.append("valor_venta", document.getElementById("total_venta_iva").value);
				var xhr = new XMLHttpRequest();
				xhr.open("POST", "http://localhost:8080/registrarventa");
				xhr.send(formData);

                setTimeout(
                function() {							
				
					formData2 = new FormData();
                    formData2.append("codigo_detalle_venta2", document.getElementById("id").value);
					formData2.append("cantidad_producto",document.getElementById("cant1").value);
					formData2.append("codigo_producto",document.getElementById("id").value);
					formData2.append("codigo_venta",document.getElementById("consecutivo").value);
					formData2.append("valor_total",document.getElementById("total_venta_iva").value);
					formData2.append("valor_venta",document.getElementById("valtotal1").value);
					formData2.append("valoriva",document.getElementById("total_iva").value);
					var xhr2 = new XMLHttpRequest();
					xhr2.open("POST", "http://localhost:8080/registrardetalleventa");
					xhr2.send(formData2);				    
				
				}, 1000);
                
                setTimeout(
                function() {							
				
					formData3 = new FormData();
                    formData3.append("codigo_detalle_venta2", document.getElementById("id2").value);
					formData3.append("cantidad_producto",document.getElementById("cant2").value);
					formData3.append("codigo_producto",document.getElementById("id2").value);
					formData3.append("codigo_venta",document.getElementById("consecutivo").value);
					formData3.append("valor_total",document.getElementById("total_venta_iva").value);
					formData3.append("valor_venta",document.getElementById("valtotal2").value);
					formData3.append("valoriva",document.getElementById("total_iva").value);
					var xhr3 = new XMLHttpRequest();
					xhr3.open("POST", "http://localhost:8080/registrardetalleventa");
					xhr3.send(formData3);				    
				
				}, 1000);

                setTimeout(
                function() {							
				
					formData4 = new FormData();
                    formData4.append("codigo_detalle_venta2", document.getElementById("id3").value);
					formData4.append("cantidad_producto",document.getElementById("cant3").value);
					formData4.append("codigo_producto",document.getElementById("id3").value);
					formData4.append("codigo_venta",document.getElementById("consecutivo").value);
					formData4.append("valor_total",document.getElementById("total_venta_iva").value);
					formData4.append("valor_venta",document.getElementById("valtotal3").value);
					formData4.append("valoriva",document.getElementById("total_iva").value);
					var xhr4 = new XMLHttpRequest();
					xhr4.open("POST", "http://localhost:8080/registrardetalleventa");
					xhr4.send(formData4);				    
				
				}, 1000);

            } catch (error) {
				var element = document.getElementById("error");
				element.classList.remove("visually-hidden");
				var element2 = document.getElementById("correcto");
				element2.classList.add("visually-hidden");
			}            
        }  
        
    </script>
    <script>
		includeHTML();
	</script>
</body>
</html>